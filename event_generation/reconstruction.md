FCC: Getting started with simulating events in Delphes
===================================================================================

## Setup the key4hep Stack

Let's start by creating a new subdirectory in our `fcc_tutorial` directory.

```bash
mkdir DelphesEDM4Hep && cd DelphesEDM4Hep
```

If you have restarted a terminal, remember to setup the latest key4hep (or FCC) stack:

```bash
source /cvmfs/sw.hsf.org/key4hep/setup.sh
```

## Generate and Simulate Events with DelphesEDM4Hep

For this tutorial we will consider the following **physics processes**:

-   e+ e- -> ZH -> Z and H to anything
-   e+ e- -> ZZ -> Z to anything
-   e+ e- -> WW -> W to anything

Let's start by downloading the official pythia cards for the three processes:

```bash
wget https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/Pythia8/p8_ee_ZH_ecm240.cmd
wget https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/Pythia8/p8_ee_ZZ_ecm240.cmd
wget https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/Pythia8/p8_ee_WW_ecm240.cmd
```

The detector response of the baseline FCC-ee IDEA detector configuration is emulated with Delphes.
Other detector cards can be found in the `$DELPHES_DIR/cards` directory, such as a ATLAS, CMS or ILD detector configurations:
`delphes_card_ATLAS.tcl`, `delphes_card_CMS.tcl` and `delphes_card_ILD.tcl`. 

We will use the official IDEA card and the unofficial CLD card here:

```bash
wget https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Delphes/card_IDEA.tcl
wget https://raw.githubusercontent.com/delphes/delphes/refs/heads/master/cards/delphes_card_FCCeeDetWithSiTracking.tcl
```

The executable `DelphesPythia8_EDM4HEP` is run with positional arguments. To check the arguments ordering, please run the executable:

```bash
DelphesPythia8_EDM4HEP -h
```

It should produce the following message:

```
Usage: DelphesPythia8config_file output_config_file pythia_card output_file
config_file - configuration file in Tcl format,
output_config_file - configuration file steering the content of the edm4hep output in Tcl format,
pythia_card - Pythia8 configuration file,
output_file - output file in ROOT format.
```

Here, the first argument is the delphes detector card,
the second argument is the configuration file for the edm4hep output (see below),
the third argument is the pythia configuration file,
and the last argument is the output file name.

Before running the executable, we need to define the collections that we want to write. These are specified in a configuration file, the official version of which can be downloaded here:

```bash
wget https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Delphes/edm4hep_IDEA.tcl
```

Now, we are fully equipped to generate events by using Pythia8 as the generator and Delphes to emulate the detector response. Starting with the ee->ZH process with the IDEA detector concept:

```bash
DelphesPythia8_EDM4HEP card_IDEA.tcl edm4hep_IDEA.tcl p8_ee_ZH_ecm240.cmd p8_ee_ZH_ecm240_edm4hep_IDEA.root
```

The same process, but using CLD for the detector response, can be generated by:

```bash
DelphesPythia8_EDM4HEP delphes_card_FCCeeDetWithSiTracking.tcl edm4hep_IDEA.tcl p8_ee_ZH_ecm240.cmd p8_ee_ZH_ecm240_edm4hep_CLD.root
```

Events for the other two processes can also be generated in a similar manner.

Using IDEA detector concept:

```bash
DelphesPythia8_EDM4HEP card_IDEA.tcl edm4hep_IDEA.tcl p8_ee_ZZ_ecm240.cmd p8_ee_ZZ_ecm240_edm4hep_IDEA.root
DelphesPythia8_EDM4HEP card_IDEA.tcl edm4hep_IDEA.tcl p8_ee_WW_ecm240.cmd p8_ee_WW_ecm240_edm4hep_IDEA.root
```

Using CLD detector concept:

```bash
DelphesPythia8_EDM4HEP delphes_card_FCCeeDetWithSiTracking.tcl edm4hep_IDEA.tcl p8_ee_ZZ_ecm240.cmd p8_ee_ZZ_ecm240_edm4hep_CLD.root
DelphesPythia8_EDM4HEP delphes_card_FCCeeDetWithSiTracking.tcl edm4hep_IDEA.tcl p8_ee_WW_ecm240.cmd p8_ee_WW_ecm240_edm4hep_CLD.root
```
